<!DOCTYPE html>
<html>
    <head>
        <link rel="stylesheet" href="static/src/styles.css"/>
        <link rel="preconnect" href="https://fonts.googleapis.com">
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700;800&family=Space+Mono&display=swap" rel="stylesheet">
        
        <title>Filmfinder</title>

        <meta charset="UTF-8"/>
    </head>
    <body background="static/src/pexels-alscre-2847648.jpg">

        <h1 class="title">What do you want to watch?</h1>
        <div class="box">

            <div class="emojis">
                <button class="btn-emoji">&#128525;</button> <!-- üòç -->
                <button class="btn-emoji">&#128148;</button> <!-- üíî -->
                <button class="btn-emoji">&#128081;</button> <!-- üëë -->
                <button class="btn-emoji">&#128143;</button> <!-- üíè -->
                <button class="btn-emoji">&#127807;</button> <!-- üåø -->
                <button class="btn-emoji">&#127963;</button> <!-- üèõ -->
                <button class="btn-emoji">&#128481;</button> <!-- ‚öî -->
                <button class="btn-emoji">&#128269;</button> <!-- üîé -->
                <button class="btn-emoji">&#128149;</button> <!-- üíï -->
                <button class="btn-emoji">&#128514;</button> <!-- üòÇ -->  
            </div>   
            
            <div class="selected-emojis">
                <div id="emoji-box" class="emoji-box"></div> 
                <button id="search-btn" class="search-btn">SEARCH</button>
            </div>

            <p id="limit-msg" class="limit-msg"></p>

            <div id="movie-recommendation"></div>

            
        </div>

        
        <script>
            const emojiBox = document.getElementById('emoji-box');
            const limitMsg = document.getElementById('limit-msg');
            const selectedEmojis = [];
            const movieRecommendation = document.getElementById('movie-recommendation');
            
            document.querySelectorAll('.btn-emoji').forEach(emoji => {
                emoji.addEventListener('click', function () {
                    const emojiChar = this.innerHTML;
            
                    if (selectedEmojis.includes(emojiChar)) {
                        limitMsg.textContent = "You have already selected this emoji.";
                        return;
                    }
            
                    if (selectedEmojis.length < 3) {
                        selectedEmojis.push(emojiChar);
                        const selectedEmoji = document.createElement('span');
                        selectedEmoji.classList.add('selected-emoji');
                        selectedEmoji.innerHTML = emojiChar;
                        emojiBox.appendChild(selectedEmoji);
                        limitMsg.textContent = ""; // Clear error
                    } else {
                        limitMsg.textContent = "You can only select up to 3 emojis.";
                    }
                });
            });
            
            document.getElementById('search-btn').addEventListener('click', async function () {
                const emojis = selectedEmojis.join('');

                if (emojis === ''){
                    alert("Please select at least one emoji.");
                    return;
                }
            
                try {
                    const token = localStorage.getItem("token");

                    if (!token) {
                        alert("Please log in to get a recommendation.");
                        return;
                    }

                    const response = await fetch("http://localhost:8000/recommend/", {
                        method: "POST",
                        headers: {
                            "Content-Type": "application/json",
                            "Authorization": `Bearer ${token}`
                        },
                        body: JSON.stringify({ emojis: emojis })
                    });
            
                    const data = await response.json();
            
                    if (response.ok) {
                        movieRecommendation.innerHTML = `
                        <h3>Recommended Movie:</h3>
                        <p><strong>${data.title}</strong></p>
                        <p>${data.description}</p>
                        <img src="${data.image}" alt="Movie Image" />
                    `;
                    } else {
                        alert("‚ùå Error: " + data.detail);
                    }
                } catch (error) {
                    console.error("‚ùå Fetch error:", error);
                    alert("Could not fetch movie recommendation.");
                }
            });
        </script>
    </body>
</html>