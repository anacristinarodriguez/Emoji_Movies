<!DOCTYPE html>
<html>
    <head>
        <link rel="stylesheet" href="src/styles.css"/>
        <link rel="preconnect" href="https://fonts.googleapis.com">
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700;800&family=Space+Mono&display=swap" rel="stylesheet">
        
        <title>Filmfinder</title>

        <meta charset="UTF-8"/>
    </head>
    <body background="src/pexels-alscre-2847648.jpg">

        <h1 class="title">What do you want to watch?</h1>
        <div class="box">

            <div class="emojis">
                <button class="btn-emoji">&#128525;</button> <!-- 😍 -->
                <button class="btn-emoji">&#128148;</button> <!-- 💔 -->
                <button class="btn-emoji">&#128081;</button> <!-- 👑 -->
                <button class="btn-emoji">&#128143;</button> <!-- 💏 -->
                <button class="btn-emoji">&#127807;</button> <!-- 🌿 -->
                <button class="btn-emoji">&#127963;</button> <!-- 🏛 -->
                <button class="btn-emoji">&#128481;</button> <!-- ⚔ -->
                <button class="btn-emoji">&#128269;</button> <!-- 🔎 -->
                <button class="btn-emoji">&#128149;</button> <!-- 💕 -->
                <button class="btn-emoji">&#128514;</button> <!-- 😂 -->  
            </div>   
            
            <div class="selected-emojis">
                <div id="emoji-box" class="emoji-box"></div> <!-- Selected emojis will show here -->
                <button id="search-btn" class="search-btn">SEARCH</button>
            </div>

            <p id="limit-msg" class="limit-msg"></p>

            
        </div>

        
        <script>
            const emojiBox = document.getElementById('emoji-box');
            const limitMsg = document.getElementById('limit-msg');
            const selectedEmojis = [];
            
            document.querySelectorAll('.btn-emoji').forEach(emoji => {
                emoji.addEventListener('click', function () {
                    const emojiChar = this.innerHTML;
            
                    if (selectedEmojis.includes(emojiChar)) {
                        limitMsg.textContent = "You have already selected this emoji.";
                        return;
                    }
            
                    if (selectedEmojis.length < 3) {
                        selectedEmojis.push(emojiChar);
                        const selectedEmoji = document.createElement('span');
                        selectedEmoji.classList.add('selected-emoji');
                        selectedEmoji.innerHTML = emojiChar;
                        emojiBox.appendChild(selectedEmoji);
                        limitMsg.textContent = ""; // Clear error
                    } else {
                        limitMsg.textContent = "You can only select up to 3 emojis.";
                    }
                });
            });
            
            document.getElementById('search-btn').addEventListener('click', async function () {
                const emojis = selectedEmojis.join('');
            
                try {
                    const response = await fetch("http://localhost:8000/recommend/", {
                        method: "POST",
                        headers: {
                            "Content-Type": "application/json"
                            // You may need to add Authorization header here if auth is enforced
                        },
                        body: JSON.stringify({ emojis: emojis })
                    });
            
                    const data = await response.json();
                    console.log("🎥 Movie recommendation:", data);
            
                    if (response.ok) {
                        alert(`🎬 Recommended: ${data.title}\n📄 ${data.description}`);
                    } else {
                        alert("❌ Error: " + data.detail);
                    }
                } catch (error) {
                    console.error("❌ Fetch error:", error);
                    alert("Could not fetch movie recommendation.");
                }
            });
        </script>
            
        <script src="watch.js"></script>
    </body>
</html>